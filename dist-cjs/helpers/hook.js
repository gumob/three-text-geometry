Object.defineProperty(exports,"__esModule",{value:!0}),exports.useFont=void 0;let tslib_1=require("tslib"),react_1=require("react"),axios_1=tslib_1.__importDefault(require("axios")),swr_1=tslib_1.__importDefault(require("swr")),three_1=require("three"),parser_1=require("../parser"),useFont=(e,r,t)=>{let n=(0,react_1.useRef)(t);let s=(0,react_1.useRef)(new Array(2).fill(0)),u=(0,react_1.useRef)(new Array(2).fill(0)),a=(0,react_1.useRef)(0),o=(0,react_1.useRef)(0),c=(0,react_1.useRef)(0),l=(0,react_1.useRef)(0),i=(e,r,t)=>{s.current[e]=r,u.current[e]=t,a.current=s.current.reduce((e,r)=>e+r,0),o.current=u.current.reduce((e,r)=>e+r,0),0!==a.current&&0!==o.current&&(c.current=Math.round(100*a.current/o.current),console.log("onProgress",n.current),console.log("calculateProgress","sumBytesLoaded",a.current,"sumBytesTotal",o.current,"sumPercentCompleted",c.current),null!=(r=n.current))&&r.call(n,a.current,o.current,c.current)};(0,react_1.useEffect)(()=>{console.log("useEffect","onProgress",t),n.current=t},[t]);var{data:e,isLoading:_}=(0,swr_1.default)(e,e=>(async(t,n)=>t?axios_1.default.get(t,{onDownloadProgress:async e=>{i(n,e.loaded,null!=(e=e.total)?e:0)}}).then(async e=>{l.current++,i(n,u.current[n],u.current[n]);var r=e.data;switch(null==(e=t.split(".").pop())?void 0:e.toLowerCase()){case"xml":return(new parser_1.BMFontXMLParser).parse(r);case"bin":return(new parser_1.BMFontBinaryParser).parse(Buffer.from(r,"utf-8"));case"json":return(new parser_1.BMFontJsonParser).parse(r);default:return(new parser_1.BMFontAsciiParser).parse(r)}}):null)(e,0)),{data:r,isLoading:d}=(0,swr_1.default)(r,e=>(async(e,n)=>e?new Promise((r,t)=>{(new three_1.TextureLoader).load(e,e=>{l.current++,i(n,u.current[n],u.current[n]),r(e)},e=>{i(n,e.loaded,null!=(e=e.total)?e:0)},e=>{t(e)})}):null)(e,1));return{font:e,texture:r,isLoading:_||d}};exports.useFont=useFont;