Object.defineProperty(exports,"__esModule",{value:!0}),exports.useFont=void 0;let tslib_1=require("tslib"),react_1=require("react"),axios_1=tslib_1.__importDefault(require("axios")),swr_1=tslib_1.__importDefault(require("swr")),three_1=require("three"),parser_1=require("../parser"),fiber_1=require("@react-three/fiber"),useFont=(e,r,u)=>{let a=(0,react_1.useRef)(u),[t,s]=(a.current=u,(0,react_1.useState)(!0));let n=(0,react_1.useRef)(new Array(2).fill(0)),o=(0,react_1.useRef)(new Array(2).fill(0)),c=(0,react_1.useRef)(0),l=(0,react_1.useRef)(0),i=(0,react_1.useRef)(0),_=(0,react_1.useRef)(0);let d=(e,r,t)=>{n.current[e]=r,o.current[e]=t,c.current=n.current.reduce((e,r)=>e+r,0),l.current=o.current.reduce((e,r)=>e+r,0),0!==c.current&&0!==l.current&&(i.current=Math.round(100*c.current/l.current),console.log("onProgress",u),console.log("calculateProgress","sumBytesLoaded",c.current,"sumBytesTotal",l.current,"sumPercentCompleted",i.current),null!=(r=a.current))&&r.call(a,c.current,l.current,i.current)};var{data:e,isLoading:f}=(0,swr_1.default)(e,e=>(async(t,u)=>t?axios_1.default.get(t,{onDownloadProgress:async e=>{d(u,e.loaded,null!=(e=e.total)?e:0)}}).then(async e=>{_.current++,d(u,o.current[u],o.current[u]);var r=e.data;switch(null==(e=t.split(".").pop())?void 0:e.toLowerCase()){case"xml":return(new parser_1.BMFontXMLParser).parse(r);case"bin":return(new parser_1.BMFontBinaryParser).parse(Buffer.from(r,"utf-8"));case"json":return(new parser_1.BMFontJsonParser).parse(r);default:return(new parser_1.BMFontAsciiParser).parse(r)}}):null)(e,0));return{font:e,texture:(0,fiber_1.useLoader)(three_1.TextureLoader,null!=r?r:"",void 0,e=>{var r;d(1,e.loaded,null!=(r=e.total)?r:0),e.loaded===e.total&&(_.current++,s(!1))}),isLoading:f||t}};exports.useFont=useFont;